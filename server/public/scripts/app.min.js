/*! duplexchicks 2016-05-04 */
var chickApp=angular.module("chickApp",["ngMaterial","ngMessages","ngRoute","googlechart"]);chickApp.config(["$routeProvider","$locationProvider",function(a,b){}]);var chickAppAdmin=angular.module("chickAppAdmin",["ngMaterial","ngMessages","ngRoute","md.data.table"]);chickAppAdmin.config(["$routeProvider","$locationProvider",function(a,b){a.when("/admin",{templateUrl:"/views/admin.html",controller:"AdminController"}).when("/emailList",{templateUrl:"/views/partials/emailList.html",controller:"EmailController"}).when("/setVariables",{templateUrl:"/views/partials/setVariables.html",controller:"SetVariablesController"}).otherwise({redirectTo:"/emailList"})}]),chickAppAdmin.controller("AdminController",["$scope","$http","$window","AdminService",function(a,b,c,d){a.toEmailList=function(){c.location.href="#emailList"},a.toDefaultValues=function(){c.location.href="#setVariables"}}]),chickAppAdmin.controller("EmailController",["$scope","$http","$window","AdminService",function(a,b,c,d){"use strict";a.removed=!1,a.selected=[],a.limitOptions=[5,10,15],a.query={order:"date",limit:5,page:1},a.getContacts=function(){b.get("/submit").then(function(b){a.emailList=b.data,console.log(a.emailList),a.count=a.emailList.length})},a.getContacts(),a.toggleLimitOptions=function(){a.limitOptions=a.limitOptions?void 0:[5,10,15]},a.loadStuff=function(){a.promise=$timeout(function(){},2e3)},a.logItem=function(a){console.log(a.name,"was selected")},a.logOrder=function(a){console.log("order: ",a)},a.logPagination=function(a,b){console.log("page: ",a),console.log("limit: ",b)},a.changeStatus=function(a){console.log("Changing status of contact with id: ",a)},a.deleteContact=function(a){console.log("Deleting contact with id: ",a),d.deleteTheContact(a)},a.changeStatus=function(b){console.log("Changing status on contact with ID: ",b),d.updateTheContact(b),a.getContacts()}}]),chickAppAdmin.controller("SetVariablesController",["$scope","$http","$window","AdminService",function(a,b,c,d){a.getDefaults=function(){b.get("/defaults").then(function(b){console.log(b.data),a.defaultVariables=b.data[0],console.log("Inside get call: ",a.defaultVariables),d.admin.defaults=a.defaultVariables})},a.getDefaults(),a.setDefaultValues=function(a){d.alterDefaults(a)}}]),chickApp.controller("InputController",["$scope","$log","$http","$window","$mdSidenav","ClientService",function(a,b,c,d,e,f){var g=f;a.toggleMenu=function(){e("left").toggle()},a.submitEmail=function(){console.log("submit was clicked",a.submit.email,a.submit.followup);var b={email:a.submit.email,maritalStatus:a.inputData.maritalStatus,zipCode:a.inputData.zipCode,income:a.inputData.income,targetPropertyPrice:a.inputData.targetPrice,followup:a.submit.followup};g.submitEmail(b),a.submit.email="",a.fade=""},a.inputData={},a.minMax={},a.getDefaults=function(){c.get("/defaults").then(function(b){defaultVariables=b.data[0],console.log("defaultVariables: ",defaultVariables),a.minMax=defaultVariables,a.inputData.monthlyRentPersonal=defaultVariables.monthlyRentPersonalDef,a.inputData.monthlyRentTenant=defaultVariables.monthlyRentTenantDef,a.inputData.targetPrice=defaultVariables.targetPriceDef,a.inputData.downPaymentPercentage=defaultVariables.downPaymentPercentageDef,a.inputData.mortgageRate=defaultVariables.mortgageRateDef,a.inputData.yearsAmmoritized=defaultVariables.yearsAmmoritizedDef,a.inputData.income=defaultVariables.incomeDef,a.inputData.mortgageYears=defaultVariables.mortgageYearsDef,a.inputData.vacancy=defaultVariables.vacancyDef,a.inputData.propertyTaxPercentage=defaultVariables.propertyTaxPercentageDef,a.inputData.assocDues=defaultVariables.assocDuesDef,a.inputData.management=defaultVariables.managementDef,a.inputData.misc=defaultVariables.miscDef,a.inputData.insuranceRate=defaultVariables.insuranceRateDef,a.inputData.utils=defaultVariables.utilsDef,a.inputData.legalAccounting=defaultVariables.legalAccountingDef,a.inputData.taxBracket=defaultVariables.taxBracketDef,a.inputData.repairValue=defaultVariables.repairValueDef,a.inputData.years=defaultVariables.yearsDef,a.inputData.maritalStatus=!1,a.inputData.zipCode=defaultVariables.zipCode,a.inputData.appreciationRate=5})},a.getDefaults();a.$watchCollection("inputData",function(b,c){console.log("Changed",b,c);var d=function(c){return a.mortMonth=b.mortgageRate/12/100,a.mortYearMonth=12*b.mortgageYears,a.principle=b.targetPrice-b.targetPrice*b.downPaymentPercentage/100,a.monthlyPayment=a.principle*(a.mortMonth*Math.pow(1+a.mortMonth,a.mortYearMonth))/(Math.pow(1+a.mortMonth,a.mortYearMonth)-1),a.constant=Math.pow(1+a.mortMonth,a.mortYearMonth),a.otherConstant=Math.pow(1+a.mortMonth,c),a.balance=a.principle*(a.constant-a.otherConstant)/(a.constant-1),a.newHomeValue=a.principle*Math.pow(Math.E,c*b.appreciationRate/100/12),a.valueGained=a.newHomeValue-a.principle,a.valueGained};d(12*b.years),console.log("check",d(12*b.years)),a.owedAfterDown=b.targetPrice*(1-b.downPaymentPercentage/100),a.mortgageRateDecimal=b.mortgageRate/100,a.mortgageRateDecimalMonthly=a.mortgageRateDecimal/12,a.monthlyBuyPre=a.owedAfterDown*a.mortgageRateDecimalMonthly*Math.pow(1+a.mortgageRateDecimalMonthly,12*b.mortgageYears)/(Math.pow(1+a.mortgageRateDecimalMonthly,12*b.mortgageYears)-1),a.annualBuyPre=12*a.monthlyBuyPre,a.propTax=b.targetPrice*b.propertyTaxPercentage/100,a.propInsurance=b.targetPrice*b.insuranceRate/100,a.firstYear=a.annualBuyPre+a.propTax+b.repairValue+b.assocDues+b.management+b.misc+a.propInsurance+b.utils+b.legalAccounting+b.targetPrice*b.downPaymentPercentage/100,a.otherYears=a.annualBuyPre+a.propTax+b.repairValue+b.assocDues+b.management+b.misc+a.propInsurance+b.utils+b.legalAccounting,a.monthPrice=a.otherYears/12,a.buy[1].v=a.firstYear+a.otherYears*(b.years-1)-a.valueGained,console.log(a.buy[1].v),a.rentHold=12*b.monthlyRentPersonal+b.utils,a.rent[1].v=a.rentHold*b.years,a.initialDuplex=a.buy[1].v,a.rentTenantAnnual=12*b.monthlyRentTenant*(1-b.vacancy/100),a.depPersProp=.05*b.targetPrice*.2,a.depBuildingValue=.5*b.targetPrice*.0348,a.depLandImprovVal=.05*b.targetPrice*.2,a.annualDebtService=a.annualBuyPre-a.owedAfterDown*a.mortgageRateDecimal,a.netOperatingIncome=a.rentTenantAnnual-a.propTax-a.propInsurance-b.repairValue-b.assocDues-b.management-b.misc-b.utils-b.legalAccounting,a.interestNet=a.owedAfterDown*a.mortgageRateDecimal,a.depTot=a.depPersProp+a.depBuildingValue+a.depLandImprovVal,a.taxableIncome=a.netOperatingIncome-a.interestNet-a.depTot,a.incomeTaxPay=a.taxableIncome*b.taxBracket/100,a.buyAndRent[1].v=a.initialDuplex-a.rentTenantAnnual-a.depPersProp-a.depBuildingValue-a.depLandImprovVal-a.incomeTaxPay,a.buyValues=[],a.rentValues=[],a.buyAndRentValues=[],count=0;var e=function(){for(var c=0;c<12*b.years;c++)count++,0==c?a.buyValues.push(b.targetPrice*b.downPaymentPercentage/100):c<=12*b.mortgageYears?a.buyValues.push(a.monthPrice*c-d(c)+b.targetPrice*b.downPaymentPercentage/100):a.buyValues.push(a.monthPrice*b.mortgageYears*12-d(c)+b.targetPrice*b.downPaymentPercentage/100),count>b.targetPrice/a.depPersProp&&(a.depPersProp=0),count>b.targetPrice/a.depLandImprovVal&&(a.depLandImprovVal=0),count>b.targetPrice/a.depBuildingValue&&(a.depBuildingValue=0),a.depPersProp=0,a.depLandImprovVal=0,a.depBuildingValue=0,a.totDepMonth=a.depBuildingValue+a.depLandImprovVal+a.depPersProp,0==c?a.buyAndRentValues.push(b.targetPrice*b.downPaymentPercentage/100-a.rentTenantAnnual/12):c<12*b.mortgageYears?a.buyAndRentValues.push(a.monthPrice*c-d(c)+b.targetPrice*b.downPaymentPercentage/100-a.rentTenantAnnual/12-a.totDepMonth*c):a.buyAndRentValues.push(a.monthPrice*b.mortgageYears*12-d(c)+b.targetPrice*b.downPaymentPercentage/100-a.depBuildingValue-a.depLandImprovVal-a.depPersProp),a.rentValues.push(b.monthlyRentPersonal*c)};e(),console.log("duck",a.buyValues);var f=[],g=function(){for(var c=0;c<12*b.years;c++){var d={c:[{v:c},{v:a.buyValues[c]},{v:a.rentValues[c]},{v:a.buyAndRentValues[c]}]};f.push(d)}};g(),a.hiddenChartObject={type:"LineChart",data:{cols:[{id:"year",label:"Years",type:"string"},{id:"buy-line",label:"Buy",type:"number"},{id:"rent-line",label:"Rent",type:"number"},{id:"buyAndRent-line",label:"Buy & Rent-out",type:"number"}],rows:f},options:{title:"Long term Return on Investment",isStacked:"true",fill:20,displayExactValues:!0,vAxis:{title:"Return"},hAxis:{title:"Years"},animation:{duration:3e3,easing:"out"}},formatters:{}}}),a.$watch.years=3,a.myChartObject={},a.myChartObject.type="ColumnChart",a.buy=[{v:"Buy"},{v:a.outputData},{v:"red"}],a.rent=[{v:"Rent"},{v:200},{v:"green"}],a.buyAndRent=[{v:"Buy & Rent-out"},{v:600},{v:"purple"}],a.myChartObject.data={cols:[{id:"options",label:"Options",type:"string"},{id:"dollars",label:"Dollars",type:"number"},{role:"style",type:"string"}],rows:[{c:a.buy},{c:a.rent},{c:a.buyAndRent}]},a.myChartObject.options={title:"Buy vs Rent vs Buy & Rent-out",animation:{duration:3e3,easing:"out"}},a.submit={},a.submit.followup=!0;var h=[1e4,2e4,3e4,4e4,5e4],i=[2e4,4e4,6e4,4e4,6e4],j=[6e4,4e4,5e4,3e4,2e4],k=5,l=[],m=function(){for(var a=0;k>a;a++){var b={c:[{v:a+1},{v:h[a]},{v:i[a]},{v:j[a]}]};l.push(b)}};m(),a.hiddenChartObject={type:"LineChart",data:{cols:[{id:"year",label:"Years",type:"string"},{id:"buy-line",label:"Buy",type:"number"},{id:"rent-line",label:"Rent",type:"number"},{id:"buyAndRent-line",label:"Buy & Rent-out",type:"number"}],rows:l},options:{title:"Long term Return on Investment",isStacked:"true",fill:20,displayExactValues:!0,vAxis:{title:"Return"},hAxis:{title:"Years"},animation:{duration:3e3,easing:"out"}},formatters:{}},a.fade="fade"}]),chickAppAdmin.factory("AdminService",["$http",function(a){var b={},c=function(c){a.put("/defaults/"+b.defaults._id,c).then(function(){console.log(c)})},d=function(){b.contacts={},console.log("Running getContacts!"),a.get("/submit").then(function(a){b.contacts=a.data,console.log(b.contacts)})},e=function(b){console.log("deleteTheContact deleteID: ",b),a.put("/submit/delete/:id",b).then(function(){d()})},f=function(b){console.log("deleteTheContact deleteID: ",b),a.put("/submit/statusChange/:id",b).then(function(){d()})};return{admin:b,alterDefaults:c,getContacts:d,deleteTheContact:e,updateTheContact:f}}]),chickApp.factory("ClientService",["$http",function(a){var b={},c=function(b){a.put("/defaults/"+b._id,b).then(function(){d()})},d=function(){a.get("/defaults").then(function(a){b.defaults=a.data[0]})},e=function(b){a.post("/submit",b).then(function(a){console.log("this was the response from the service submitemail",a)})},f={monthlyRentTenantDef:1290,monthlyRentTenantMin:100,monthlyRentTenantMax:1e4,monthlyRentPersonalDef:1500,monthlyRentPersonalMin:200,monthlyRentPersonalMax:1e4,targetPriceDef:266e3,targetPriceMin:5e4,targetPriceMax:5e6,downPaymentPercentageDef:3,downPaymentPercentageMin:0,downPaymentPercentageMax:100,mortgageRateDef:4.25,mortgageRateMin:0,mortgageRateMax:20,yearsAmmoritizedDef:10,yearsAmmoritizedMin:0,yearsAmmoritizedMax:100,incomeDef:8e4,incomeMin:1e4,incomeMax:1e6,mortgageYearsDef:30,mortgageYearsMin:0,mortgageYearsMax:100,vacancyDef:5,vacancyMin:0,vacancyMax:100,propertyTaxPercentageDef:1.65,propertyTaxPercentageMin:0,propertyTaxPercentageMax:100,assocDuesDef:0,assocDuesMin:0,assocDuesMax:1e4,managementDef:0,managementMin:0,managementMax:1e4,miscDef:1e3,miscMin:0,miscMax:1e5,insuranceRateDef:1,insuranceRateMin:0,insuranceRateMax:100,utilsDef:100,utilsMin:0,utilsMax:1e4,legalAccountingDef:100,legalAccountingMin:0,legalAccountingMax:1e4,taxBracketDef:28,taxBracketMin:39.9,taxBracketMax:0,repairValueDef:1400,repairValueMin:0,repairValueMax:1e5,yearsDef:5,yearsMin:0,yearsMax:100,zipCode:50466},g=function(){a.get("/checkDB").then(function(b){var c=b.data;0==c?a.post("/defaults",f).then(function(a){d()}):d()})};return g(),{alterDefaults:c,client:b,getDefaults:d,submitEmail:e}}]);